{% extends "shop/base.html" %}
{% load i18n %}
{% load mathfilters %}
{% block head_title %}
{% trans 'Checkout' %}
{% endblock head_title %}
{% block content %}
<div class="container">
    <div class="table-responsive">
        <table class="table">
            <thead>
            <tr>
                <th scope="col">{% trans 'Number' %}</th>
                <th scope="col">{% trans 'Title' %}</th>
                <th scope="col">{% trans 'Price' %}</th>
                <th scope="col">{% trans 'Amount' %}</th>
            </tr>
            </thead>
            <tbody>
            {% for order_item in object.order_items.all %}
            <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td style="width: 25%">
                    <a href="{% url 'shop:product' order_item.item.slug %}">
                        {{ order_item.item.title }}
                    </a>
                </td>
                <td style="width: 25%">{{ order_item.item.price }}₽</td>
                <td style="width: 25%">
                    <p>{{ order_item.quantity }}</p>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5">{% trans 'Your cart is empty' %}</td>
            </tr>
            {% endfor %}
            <tr>
                <td colspan="3"><b>{% trans 'Total of all' %}</b></td>
                <td colspan="4">{{ object.get_total_price }} ₽</td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="row">
        <div id="paypal-button-container" class="col-sm-8 mb-4"></div>
    </div>
</div>
<script src="https://www.paypal.com/sdk/js?client-id=AUivhdn-BsqPxrRznjAlGYfGmdqx9nacdaYnlCRqsfF9Vk0LvnUchnWF3D5zvBTcOQcNZnSmf6GJ7l1w&currency=RUB"></script>

<script>
    var total = '{{ object.get_total_price }}'
    // Render the PayPal button into #paypal-button-container
    paypal.Buttons({

        style: {
            color:  'blue',
            shape:  'rect',
        },

        // Set up the transaction
        createOrder: function(data, actions) {
            return actions.order.create({
                purchase_units: [{
                    amount: {
                        value:parseFloat(total).toFixed(2)
                    }
                }]
            });
        },

        // Finalize the transaction
        onApprove: function(data, actions) {
            return actions.order.capture().then(function(details) {
                // Show a success message to the buyer
                submitFormData()
            });
        }

    }).render('#paypal-button-container');

</script>
{% endblock content %}
